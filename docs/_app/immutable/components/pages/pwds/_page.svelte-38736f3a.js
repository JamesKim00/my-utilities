import{S as M,i as ee,s as te,k as b,a as A,q as O,P as ve,l as E,m as B,h as f,c as T,r as R,n as P,D as u,b as S,L as V,J as q,M as be,B as W,N as Ee,Q as Ae,u as Te,w as ce,x as fe,y as ue,f as de,t as he,z as me}from"../../../chunks/index-315e23ad.js";import{g as Pe,s as Q}from"../../../chunks/supabase-c0727588.js";import{_ as Se}from"../../../chunks/preload-helper-b21cceae.js";const Z=function(){const i={argon2d:0,argon2i:1,argon2id:2};function t(s){if(t._promise)return t._promise;if(t._module)return Promise.resolve(t._module);let l=p().then(o=>new Promise(r=>{o.postRun.push(()=>r(o))}));return t._promise=l,l.then(o=>(t._module=o,delete t._promise,o))}function p(){return Se(()=>import("../../../chunks/argon2-70c53f06.js"),[],import.meta.url).then(s=>s.default)}function a(s,l){const o=l instanceof Uint8Array||l instanceof Array?l:h(l),r=new Uint8Array([...o,0]);return s.allocate(r,"i8",s.ALLOC_NORMAL)}function h(s){if(typeof TextEncoder=="function")return new TextEncoder().encode(s);if(typeof Buffer=="function")return Buffer.from(s);throw new Error("Don't know how to decode UTF8")}function c(s){const l=s.mem||1024;return t().then(o=>{const r=s.time||1,m=s.parallelism||1,_=a(o,s.pass),y=s.pass.length,g=a(o,s.salt),e=s.salt.length,d=o.allocate(new Array(s.hashLen||24),"i8",o.ALLOC_NORMAL),$=s.hashLen||24,H=o.allocate(new Array(512),"i8",o.ALLOC_NORMAL),G=512,k=s.type||i.argon2d,J=19;let I,L;try{L=o._argon2_hash(r,l,m,_,y,g,e,d,$,H,G,k,J)}catch(N){I=N}let x;if(L===0&&!I){let N="";const F=new Uint8Array($);for(let U=0;U<$;U++){const K=o.HEAP8[d+U];F[U]=K,N+=("0"+(255&K).toString(16)).slice(-2)}const j=o.UTF8ToString(H);x={hash:F,hashHex:N,encoded:j}}else{try{I||(I=o.UTF8ToString(o._argon2_error_message(L)))}catch{}x={message:I,code:L}}try{o._free(_),o._free(g),o._free(d),o._free(H)}catch{}if(I)throw x;return x})}function n(s){return t().then(l=>{const o=a(l,s.pass),r=s.pass.length,m=a(l,s.encoded);let _=s.type;if(_===void 0){let d=s.encoded.split("$")[1];d&&(d=d.replace("a","A"),_=i[d]||i.argon2d)}let y,g;try{g=l._argon2_verify(m,o,r,_)}catch(d){y=d}let e;if(g||y){try{y||(y=l.UTF8ToString(l._argon2_error_message(g)))}catch{}e={message:y,code:g}}try{l._free(o),l._free(m)}catch{}if(y)throw e;return e})}return{ArgonType:i,hash:c,verify:n}}();let z=null;async function _e(i=""){if(z)return z;Z||await new Promise(c=>setTimeout(c,500));const t=(await Pe()).data.user,p=t==null?void 0:t.email;for(;!i;){const c=prompt("Please enter your master password","Master Password");if(!c||c==="Master Password")continue;const{error:n}=await Q.auth.signInWithPassword({password:c,email:p});n||(i=c)}let a=t==null?void 0:t.user_metadata.salt;a||(a=ge(10),await Q.auth.updateUser({data:{name:t==null?void 0:t.user_metadata.name,salt:a}}));const h=(await Z.hash({pass:p+i,salt:a,type:Z.ArgonType.Argon2id,hashLen:16,time:2,mem:1024})).hash.buffer;return z=await crypto.subtle.importKey("raw",h,{name:"AES-GCM"},!0,["decrypt","encrypt"]),z}function ge(i){let t=new Uint8Array((i||40)/2);return self.crypto.getRandomValues(t),Array.from(t,p=>p.toString(16).padStart(2,"0")).join("")}async function Le(i){const t=await _e(),p=new TextEncoder().encode(JSON.stringify(i)),a=self.crypto.getRandomValues(new Uint8Array(12)),h=await self.crypto.subtle.encrypt({name:"AES-GCM",iv:a},t,p),c=r=>[...new Uint8Array(r)].map(m=>m.toString(16).padStart(2,"0")).join(""),n=c(h),s=c(a.buffer),{data:l,error:o}=await Q.from("passwords").insert([{epds:n,iv:s}]);if(o)throw o;alert("Added password!")}async function $e(){const i=await _e(),{data:t,error:p}=await Q.from("passwords").select("created_at,epds,iv");if(p)throw p;const a=c=>new Uint8Array(c.match(/[\da-f]{2}/gi).map(n=>parseInt(n,16))),h=[];for(let c of t){const n=a(c.epds),s=a(c.iv),l=await self.crypto.subtle.decrypt({name:"AES-GCM",iv:s},i,n),o=new TextDecoder().decode(l);h.push(o)}return h}const{document:we}=Ae;function Ue(i){let t,p,a,h,c,n,s,l,o,r,m,_,y,g,e,d,$,H,G,k,J,I,L,x,N,F,j,U,K,D,Y,X,se;return{c(){t=b("script"),p=A(),a=b("p"),h=O("Add password:"),c=A(),n=b("form"),s=b("label"),l=O("Email:"),o=A(),r=b("input"),m=A(),_=b("label"),y=O("Password:"),g=A(),e=b("input"),d=A(),$=b("button"),H=O("(show password)?"),G=A(),k=b("label"),J=O("description:"),I=A(),L=b("input"),x=A(),N=b("label"),F=O("Site: (don't need to add https://, can leave empty)"),j=A(),U=b("input"),K=A(),D=b("button"),Y=O("Submit"),this.h()},l(w){const C=ve("svelte-1kwds8g",we.head);t=E(C,"SCRIPT",{});var ye=B(t);ye.forEach(f),C.forEach(f),p=T(w),a=E(w,"P",{});var re=B(a);h=R(re,"Add password:"),re.forEach(f),c=T(w),n=E(w,"FORM",{});var v=B(n);s=E(v,"LABEL",{for:!0});var ne=B(s);l=R(ne,"Email:"),ne.forEach(f),o=T(v),r=E(v,"INPUT",{id:!0,type:!0,placeholder:!0}),m=T(v),_=E(v,"LABEL",{for:!0});var ae=B(_);y=R(ae,"Password:"),ae.forEach(f),g=T(v),e=E(v,"INPUT",{id:!0,type:!0,placeholder:!0}),d=T(v),$=E(v,"BUTTON",{type:!0});var oe=B($);H=R(oe,"(show password)?"),oe.forEach(f),G=T(v),k=E(v,"LABEL",{for:!0});var ie=B(k);J=R(ie,"description:"),ie.forEach(f),I=T(v),L=E(v,"INPUT",{type:!0,placeholder:!0}),x=T(v),N=E(v,"LABEL",{for:!0});var le=B(N);F=R(le,"Site: (don't need to add https://, can leave empty)"),le.forEach(f),j=T(v),U=E(v,"INPUT",{type:!0,placeholder:!0}),K=T(v),D=E(v,"BUTTON",{type:!0});var pe=B(D);Y=R(pe,"Submit"),pe.forEach(f),v.forEach(f),this.h()},h(){P(s,"for","email"),P(r,"id","email"),P(r,"type","email"),P(r,"placeholder","Email"),r.required=!0,P(_,"for","password"),P(e,"id","pwd"),P(e,"type","password"),P(e,"placeholder","Password"),e.required=!0,P($,"type","button"),P(k,"for","description"),P(L,"type","text"),P(L,"placeholder","description"),L.required=!0,P(N,"for","site"),P(U,"type","text"),P(U,"placeholder","google.com"),P(D,"type","submit")},m(w,C){u(we.head,t),S(w,p,C),S(w,a,C),u(a,h),S(w,c,C),S(w,n,C),u(n,s),u(s,l),u(n,o),u(n,r),V(r,i[0].email),u(n,m),u(n,_),u(_,y),u(n,g),u(n,e),V(e,i[0].password),u(n,d),u(n,$),u($,H),u(n,G),u(n,k),u(k,J),u(n,I),u(n,L),V(L,i[0].description),u(n,x),u(n,N),u(N,F),u(n,j),u(n,U),V(U,i[0].site),u(n,K),u(n,D),u(D,Y),X||(se=[q(r,"input",i[2]),q(e,"input",i[3]),q($,"click",Be),q(L,"input",i[4]),q(U,"input",i[5]),q(n,"submit",be(i[1]))],X=!0)},p(w,[C]){C&1&&r.value!==w[0].email&&V(r,w[0].email),C&1&&e.value!==w[0].password&&V(e,w[0].password),C&1&&L.value!==w[0].description&&V(L,w[0].description),C&1&&U.value!==w[0].site&&V(U,w[0].site)},i:W,o:W,d(w){f(t),w&&f(p),w&&f(a),w&&f(c),w&&f(n),X=!1,Ee(se)}}}function Be(){const i=document.getElementById("pwd");i.type==="password"?i.type="text":i.type="password"}function Ne(i,t,p){const a={email:"",password:"",description:"",site:""};async function h(){await Le(a)}function c(){a.email=this.value,p(0,a)}function n(){a.password=this.value,p(0,a)}function s(){a.description=this.value,p(0,a)}function l(){a.site=this.value,p(0,a)}return[a,h,c,n,s,l]}class Oe extends M{constructor(t){super(),ee(this,t,Ne,Ue,te,{})}}function Re(i){let t,p,a,h,c,n,s,l,o;return{c(){t=b("h1"),p=O("The passwords!!!!!!!"),a=A(),h=b("button"),c=O("Show the passwords"),n=A(),s=O(i[0])},l(r){t=E(r,"H1",{});var m=B(t);p=R(m,"The passwords!!!!!!!"),m.forEach(f),a=T(r),h=E(r,"BUTTON",{});var _=B(h);c=R(_,"Show the passwords"),_.forEach(f),n=T(r),s=R(r,i[0])},m(r,m){S(r,t,m),u(t,p),S(r,a,m),S(r,h,m),u(h,c),S(r,n,m),S(r,s,m),l||(o=q(h,"click",i[1]),l=!0)},p(r,[m]){m&1&&Te(s,r[0])},i:W,o:W,d(r){r&&f(t),r&&f(a),r&&f(h),r&&f(n),r&&f(s),l=!1,o()}}}function Ce(i,t,p){let a="NOT HERE YET";async function h(){p(0,a=JSON.stringify(await $e()))}return[a,h]}class He extends M{constructor(t){super(),ee(this,t,Ce,Re,te,{})}}function Ie(i){let t,p,a,h,c,n,s,l,o,r,m,_,y,g;return l=new Oe({}),y=new He({}),{c(){t=A(),p=b("a"),a=O("Back to home"),h=A(),c=b("h1"),n=O("Passwords!"),s=A(),ce(l.$$.fragment),o=A(),r=b("h1"),m=O("See passwords:"),_=A(),ce(y.$$.fragment),this.h()},l(e){t=T(e),p=E(e,"A",{href:!0});var d=B(p);a=R(d,"Back to home"),d.forEach(f),h=T(e),c=E(e,"H1",{});var $=B(c);n=R($,"Passwords!"),$.forEach(f),s=T(e),fe(l.$$.fragment,e),o=T(e),r=E(e,"H1",{});var H=B(r);m=R(H,"See passwords:"),H.forEach(f),_=T(e),fe(y.$$.fragment,e),this.h()},h(){P(p,"href","/")},m(e,d){S(e,t,d),S(e,p,d),u(p,a),S(e,h,d),S(e,c,d),u(c,n),S(e,s,d),ue(l,e,d),S(e,o,d),S(e,r,d),u(r,m),S(e,_,d),ue(y,e,d),g=!0},p:W,i(e){g||(de(l.$$.fragment,e),de(y.$$.fragment,e),g=!0)},o(e){he(l.$$.fragment,e),he(y.$$.fragment,e),g=!1},d(e){e&&f(t),e&&f(p),e&&f(h),e&&f(c),e&&f(s),me(l,e),e&&f(o),e&&f(r),e&&f(_),me(y,e)}}}class qe extends M{constructor(t){super(),ee(this,t,null,Ie,te,{})}}export{qe as default};
