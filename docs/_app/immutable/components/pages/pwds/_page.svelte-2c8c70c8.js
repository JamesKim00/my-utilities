import{S as Z,i as ee,s as te,k as _,a as v,q as U,P as ye,l as y,m as L,h as n,c as E,r as B,n as b,D as u,b as $,L as M,J as g,M as Ee,B as G,N as $e,Q as Pe,u as Se,e as ue,w as de,x as fe,y as ce,f as me,t as we,z as he,R as Te}from"../../../chunks/index-164e1eab.js";import{g as Ae,s as x}from"../../../chunks/supabase-d1565cbc.js";let j;const Le=async o=>j=o,Ue=()=>!j;let J=null;async function be(o=""){if(J)return J;for(;!j;)await new Promise(i=>setTimeout(i,50));const e=(await Ae()).data.user,l=e==null?void 0:e.email;for(;!o;){const i=prompt("Please enter your master password","Master Password");if(!i||i==="Master Password")continue;const{error:t}=await x.auth.signInWithPassword({password:i,email:l});t||(o=i)}let s=e==null?void 0:e.user_metadata.salt;s||(s=Be(10),await x.auth.updateUser({data:{name:e==null?void 0:e.user_metadata.name,salt:s}}));const p=(await j.hash({pass:l+o,salt:s,type:j.ArgonType.Argon2id,hashLen:16,time:2,mem:1024})).hash.buffer;return J=await crypto.subtle.importKey("raw",p,{name:"AES-GCM"},!0,["decrypt","encrypt"]),J}function Be(o){let e=new Uint8Array((o||40)/2);return self.crypto.getRandomValues(e),Array.from(e,l=>l.toString(16).padStart(2,"0")).join("")}async function Ne(o){const e=await be(),l=new TextEncoder().encode(JSON.stringify(o)),s=self.crypto.getRandomValues(new Uint8Array(12)),p=await self.crypto.subtle.encrypt({name:"AES-GCM",iv:s},e,l),i=r=>[...new Uint8Array(r)].map(c=>c.toString(16).padStart(2,"0")).join(""),t=i(p),d=i(s.buffer),{data:S,error:T}=await x.from("passwords").insert([{epds:t,iv:d}]);if(T)throw T;alert("Added password!")}async function ke(){const o=await be(),{data:e,error:l}=await x.from("passwords").select("created_at,epds,iv");if(l)throw l;const s=i=>new Uint8Array(i.match(/[\da-f]{2}/gi).map(t=>parseInt(t,16))),p=[];for(let i of e){const t=s(i.epds),d=s(i.iv),S=await self.crypto.subtle.decrypt({name:"AES-GCM",iv:d},o,t),T=new TextDecoder().decode(S);p.push(T)}return p}const{document:_e}=Pe;function Ie(o){let e,l,s,p,i,t,d,S,T,r,c,A,C,R,w,q,P,a,h,I,H,K,k,z,D,F,Q,O,W,V,Y,X,se;return{c(){e=_("script"),l=v(),s=_("p"),p=U("Add password:"),i=v(),t=_("form"),d=_("label"),S=U("Email:"),T=v(),r=_("input"),c=v(),A=_("label"),C=U("Password:"),R=v(),w=_("input"),q=v(),P=_("button"),a=U("(show password)?"),h=v(),I=_("label"),H=U("description:"),K=v(),k=_("input"),z=v(),D=_("label"),F=U("Site: (don't need to add https://, can leave empty)"),Q=v(),O=_("input"),W=v(),V=_("button"),Y=U("Submit"),this.h()},l(f){const N=ye("svelte-1kwds8g",_e.head);e=y(N,"SCRIPT",{});var ve=L(e);ve.forEach(n),N.forEach(n),l=E(f),s=y(f,"P",{});var ae=L(s);p=B(ae,"Add password:"),ae.forEach(n),i=E(f),t=y(f,"FORM",{});var m=L(t);d=y(m,"LABEL",{for:!0});var re=L(d);S=B(re,"Email:"),re.forEach(n),T=E(m),r=y(m,"INPUT",{id:!0,type:!0,placeholder:!0}),c=E(m),A=y(m,"LABEL",{for:!0});var oe=L(A);C=B(oe,"Password:"),oe.forEach(n),R=E(m),w=y(m,"INPUT",{id:!0,type:!0,placeholder:!0}),q=E(m),P=y(m,"BUTTON",{type:!0});var ne=L(P);a=B(ne,"(show password)?"),ne.forEach(n),h=E(m),I=y(m,"LABEL",{for:!0});var ie=L(I);H=B(ie,"description:"),ie.forEach(n),K=E(m),k=y(m,"INPUT",{type:!0,placeholder:!0}),z=E(m),D=y(m,"LABEL",{for:!0});var le=L(D);F=B(le,"Site: (don't need to add https://, can leave empty)"),le.forEach(n),Q=E(m),O=y(m,"INPUT",{type:!0,placeholder:!0}),W=E(m),V=y(m,"BUTTON",{type:!0});var pe=L(V);Y=B(pe,"Submit"),pe.forEach(n),m.forEach(n),this.h()},h(){b(d,"for","email"),b(r,"id","email"),b(r,"type","email"),b(r,"placeholder","Email"),r.required=!0,b(A,"for","password"),b(w,"id","pwd"),b(w,"type","password"),b(w,"placeholder","Password"),w.required=!0,b(P,"type","button"),b(I,"for","description"),b(k,"type","text"),b(k,"placeholder","description"),k.required=!0,b(D,"for","site"),b(O,"type","text"),b(O,"placeholder","google.com"),b(V,"type","submit")},m(f,N){u(_e.head,e),$(f,l,N),$(f,s,N),u(s,p),$(f,i,N),$(f,t,N),u(t,d),u(d,S),u(t,T),u(t,r),M(r,o[0].email),u(t,c),u(t,A),u(A,C),u(t,R),u(t,w),M(w,o[0].password),u(t,q),u(t,P),u(P,a),u(t,h),u(t,I),u(I,H),u(t,K),u(t,k),M(k,o[0].description),u(t,z),u(t,D),u(D,F),u(t,Q),u(t,O),M(O,o[0].site),u(t,W),u(t,V),u(V,Y),X||(se=[g(r,"input",o[2]),g(w,"input",o[3]),g(P,"click",Oe),g(k,"input",o[4]),g(O,"input",o[5]),g(t,"submit",Ee(o[1]))],X=!0)},p(f,[N]){N&1&&r.value!==f[0].email&&M(r,f[0].email),N&1&&w.value!==f[0].password&&M(w,f[0].password),N&1&&k.value!==f[0].description&&M(k,f[0].description),N&1&&O.value!==f[0].site&&M(O,f[0].site)},i:G,o:G,d(f){n(e),f&&n(l),f&&n(s),f&&n(i),f&&n(t),X=!1,$e(se)}}}function Oe(){const o=document.getElementById("pwd");o.type==="password"?o.type="text":o.type="password"}function Re(o,e,l){const s={email:"",password:"",description:"",site:""};async function p(){await Ne(s)}function i(){s.email=this.value,l(0,s)}function t(){s.password=this.value,l(0,s)}function d(){s.description=this.value,l(0,s)}function S(){s.site=this.value,l(0,s)}return[s,p,i,t,d,S]}class qe extends Z{constructor(e){super(),ee(this,e,Re,Ie,te,{})}}function Me(o){let e,l,s,p,i,t,d,S,T;return{c(){e=_("h1"),l=U("The passwords!!!!!!!"),s=v(),p=_("button"),i=U("Show the passwords"),t=v(),d=U(o[0])},l(r){e=y(r,"H1",{});var c=L(e);l=B(c,"The passwords!!!!!!!"),c.forEach(n),s=E(r),p=y(r,"BUTTON",{});var A=L(p);i=B(A,"Show the passwords"),A.forEach(n),t=E(r),d=B(r,o[0])},m(r,c){$(r,e,c),u(e,l),$(r,s,c),$(r,p,c),u(p,i),$(r,t,c),$(r,d,c),S||(T=g(p,"click",o[1]),S=!0)},p(r,[c]){c&1&&Se(d,r[0])},i:G,o:G,d(r){r&&n(e),r&&n(s),r&&n(p),r&&n(t),r&&n(d),S=!1,T()}}}function ge(o,e,l){let s="NOT HERE YET";async function p(){l(0,s=JSON.stringify(await ke()))}return[s,p]}class Ce extends Z{constructor(e){super(),ee(this,e,ge,Me,te,{})}}function He(o){let e,l,s,p;return{c(){e=_("script"),this.h()},l(i){e=y(i,"SCRIPT",{src:!0});var t=L(e);t.forEach(n),this.h()},h(){Te(e.src,l="node_modules/argon2-browser/dist/argon2-bundled.min.js")||b(e,"src",l)},m(i,t){$(i,e,t),s||(p=g(e,"load",o[0]),s=!0)},p:G,d(i){i&&n(e),s=!1,p()}}}function Ke(o){let e=Ue(),l,s,p,i,t,d,S,T,r,c,A,C,R,w,q,P=e&&He(o);return r=new qe({}),w=new Ce({}),{c(){P&&P.c(),l=ue(),s=v(),p=_("a"),i=U("Back to home"),t=v(),d=_("h1"),S=U("Passwords!"),T=v(),de(r.$$.fragment),c=v(),A=_("h1"),C=U("See passwords:"),R=v(),de(w.$$.fragment),this.h()},l(a){const h=ye("svelte-o6eqf",document.head);P&&P.l(h),l=ue(),h.forEach(n),s=E(a),p=y(a,"A",{href:!0});var I=L(p);i=B(I,"Back to home"),I.forEach(n),t=E(a),d=y(a,"H1",{});var H=L(d);S=B(H,"Passwords!"),H.forEach(n),T=E(a),fe(r.$$.fragment,a),c=E(a),A=y(a,"H1",{});var K=L(A);C=B(K,"See passwords:"),K.forEach(n),R=E(a),fe(w.$$.fragment,a),this.h()},h(){b(p,"href","/")},m(a,h){P&&P.m(document.head,null),u(document.head,l),$(a,s,h),$(a,p,h),u(p,i),$(a,t,h),$(a,d,h),u(d,S),$(a,T,h),ce(r,a,h),$(a,c,h),$(a,A,h),u(A,C),$(a,R,h),ce(w,a,h),q=!0},p(a,[h]){e&&P.p(a,h)},i(a){q||(me(r.$$.fragment,a),me(w.$$.fragment,a),q=!0)},o(a){we(r.$$.fragment,a),we(w.$$.fragment,a),q=!1},d(a){P&&P.d(a),n(l),a&&n(s),a&&n(p),a&&n(t),a&&n(d),a&&n(T),he(r,a),a&&n(c),a&&n(A),a&&n(R),he(w,a)}}}function De(o){return[()=>{console.log("LOADED!"),Le(argon2)}]}class Ge extends Z{constructor(e){super(),ee(this,e,De,Ke,te,{})}}export{Ge as default};
